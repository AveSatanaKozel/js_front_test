<!--<!DOCTYPE html>-->
<!--<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Admin</title>-->
<!--    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"-->
<!--          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">-->
<!--</head>-->

<!--<body>-->
<!--<nav class="navbar navbar-dark bg-dark justify-content-between">-->
<!--    <div class="navbar-brand">-->
<!--        <td th:text="${user.username}"/>-->
<!--        with roles:-->
<!--        <td th:text="${user.roles}"/>  &lt;!&ndash;     спросить у Вадима как сделать не ссылкой&ndash;&gt;-->
<!--    </div>-->
<!--    <form action="/logout" method="POST">-->

<!--        <button class="btn btn-dark " type="submit">Logout</button>-->
<!--    </form>-->
<!--</nav>-->


<!--<div class="container-fluid ">-->
<!--    <br/>-->
<!--    <div class="row justify-content-md-center">-->
<!--        <div class="col-lg-2 ">-->


<!--            &lt;!&ndash; 1 из 2 (узкая) &ndash;&gt;-->
<!--            <div class="list-group col-sm-12 sidenav" >-->
<!--                <form action="/user" method="GET">-->
<!--                    <button class="btn btn-primary btn-block"  style="text-align: left" type="submit">User</button>-->
<!--                </form>-->
<!--            </div> &lt;!&ndash; 1 из 2 (узкая) Close &ndash;&gt;-->

<!--        </div>-->

<!--        <div class="col-lg-10 gray tab-content">       &lt;!&ndash; 2 из 2 (широкая) &ndash;&gt;-->


<!--            <h2>User information-page</h2>-->


<!--                <div class="gray border">-->
<!--                    <h4 style="text-align: left; margin: 1%"> About user</h4>-->
<!--                </div>-->

<!--            <table class="table table-striped table-bordered">-->

<!--                <thead>-->
<!--                <tr>-->
<!--                    <th>ID</th>-->
<!--                    <th>First name</th>-->
<!--                    <th>City</th>-->
<!--                    <th>Email</th>-->
<!--                    <th>Role</th>-->
<!--                </tr>-->

<!--                </thead>-->

<!--                <tbody>-->
<!--                <tr>-->
<!--                    <td th:text="${user.id}"/>-->
<!--                    <td th:text="${user.username}"/>-->
<!--                    <td th:text="${user.city}"/>-->
<!--                    <td th:text="${user.email}"/>-->
<!--                    <td th:text="${user.roles}"/>-->
<!--                </tr>-->
<!--                </tbody>-->
<!--            </table>-->
<!--        </div>       &lt;!&ndash; 2 из 2 (широкая) Close &ndash;&gt;-->
<!--    </div>-->
<!--</div>-->
<!--</div>-->
<!--<br/>-->
<!--</body>-->
<!--</html>-->


<!--<!DOCTYPE html>-->
<!--<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Admin</title>-->
<!--    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"-->
<!--          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">-->
<!--</head>-->

<!--<body>-->
<!--<nav class="navbar navbar-dark bg-dark justify-content-between">-->
<!--    <div class="navbar-brand">-->
<!--        <td th:text="${user.username}"/>-->
<!--        with roles:-->
<!--        <td th:text="${user.roles}"/>  &lt;!&ndash;     спросить у Вадима как сделать не ссылкой&ndash;&gt;-->
<!--    </div>-->
<!--    <form action="/logout" method="POST">-->

<!--        <button class="btn btn-dark " type="submit">Logout</button>-->
<!--    </form>-->
<!--</nav>-->

<!--<div style="display: grid; grid-template-columns: 1fr 5fr; height: calc(100vh - 88px)">-->
<!--    &lt;!&ndash; Left panel &ndash;&gt;-->
<!--    <div class="list-group col-sm-12 sidenav margin white" id="list-tab" role="tablist">-->
<!--        <a class="list-group-item list-group-item-action active" id="list-user" data-toggle="list"-->
<!--           th:href="@{/user}"-->
<!--           role="tab">User</a>-->
<!--    </div> &lt;!&ndash; Left panel Close &ndash;&gt;-->
<!--    <div class="container-fluid" style="background: #eee">-->


<!--        <h2>User information-page</h2>-->
<!--        <hr>-->
<!--        <h4> About user</h4>-->
<!--        <hr>-->
<!--        <table class="table table-striped table-bordered">-->

<!--            <thead>-->
<!--            <tr>-->
<!--                <th>ID</th>-->
<!--                <th>First name</th>-->
<!--                <th>City</th>-->
<!--                <th>Email</th>-->
<!--                <th>Role</th>-->
<!--            </tr>-->

<!--            </thead>-->

<!--            <tbody>-->


<!--            <tr>-->
<!--                <td th:text="${user.id}"/>-->
<!--                <td th:text="${user.username}"/>-->
<!--                <td th:text="${user.city}"/>-->
<!--                <td th:text="${user.email}"/>-->
<!--                <td th:text="${user.roles}"/>-->
<!--            </tr>-->
<!--            </tbody>-->
<!--        </table>-->


<!--    </div>-->
<!--</div>-->

<!--&lt;!&ndash;<div class="container-fluid ">&ndash;&gt;-->
<!--&lt;!&ndash;    <br/>&ndash;&gt;-->
<!--&lt;!&ndash;    <div class="row justify-content-md-center">&ndash;&gt;-->
<!--&lt;!&ndash;        <div class="col-lg-2 ">&ndash;&gt;-->

<!--&lt;!&ndash;            1 из 2 (узкая)&ndash;&gt;-->


<!--&lt;!&ndash;        </div>&ndash;&gt;-->
<!--&lt;!&ndash;        <div class="col-lg-10" style="background: #eee">&ndash;&gt;-->
<!--&lt;!&ndash;            2 из 2 (широкая)&ndash;&gt;-->


<!--            <h2>User information-page</h2>-->
<!--            <hr>-->
<!--            <h4> About user</h4>-->
<!--            <hr>-->
<!--                        <table class="table">-->

<!--                        <thead class="thead-gray table-bordered">-->
<!--                        <tr>-->
<!--                            &lt;!&ndash;            <h5>About user</h5>&ndash;&gt;-->
<!--                            <th>About user</th>-->
<!--                        </tr>-->
<!--                        </thead>-->


<!--&lt;!&ndash;&lt;!&ndash;                <div class="white">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    <div class="gray border">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                        <h4 style="text-align: left; margin: 1%"> About user</h4>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    </div>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                </div>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;                <table class="table table-striped table-bordered">&ndash;&gt;-->

<!--&lt;!&ndash;                    <thead>&ndash;&gt;-->
<!--&lt;!&ndash;                    <tr>&ndash;&gt;-->
<!--&lt;!&ndash;                        <th>ID</th>&ndash;&gt;-->
<!--&lt;!&ndash;                        <th>First name</th>&ndash;&gt;-->
<!--&lt;!&ndash;                        <th>City</th>&ndash;&gt;-->
<!--&lt;!&ndash;                        <th>Email</th>&ndash;&gt;-->
<!--&lt;!&ndash;                        <th>Role</th>&ndash;&gt;-->
<!--&lt;!&ndash;                    </tr>&ndash;&gt;-->

<!--&lt;!&ndash;                    </thead>&ndash;&gt;-->

<!--&lt;!&ndash;                    <tbody>&ndash;&gt;-->


<!--&lt;!&ndash;                    <tr>&ndash;&gt;-->
<!--&lt;!&ndash;                        <td th:text="${user.id}"/>&ndash;&gt;-->
<!--&lt;!&ndash;                        <td th:text="${user.username}"/>&ndash;&gt;-->
<!--&lt;!&ndash;                        <td th:text="${user.city}"/>&ndash;&gt;-->
<!--&lt;!&ndash;                        <td th:text="${user.email}"/>&ndash;&gt;-->
<!--&lt;!&ndash;                        <td th:text="${user.roles}"/>&ndash;&gt;-->
<!--&lt;!&ndash;                    </tr>&ndash;&gt;-->
<!--&lt;!&ndash;                    </tbody>&ndash;&gt;-->
<!--&lt;!&ndash;                </table>&ndash;&gt;-->
<!--&lt;!&ndash;            </table>&ndash;&gt;-->
<!--&lt;!&ndash;        </div>&ndash;&gt;-->
<!--&lt;!&ndash;    </div>&ndash;&gt;-->
<!--&lt;!&ndash;</div>&ndash;&gt;-->
<!--</div>-->

<!--<br/>-->


<!--&lt;!&ndash;<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"&ndash;&gt;-->
<!--&lt;!&ndash;        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"&ndash;&gt;-->
<!--&lt;!&ndash;        crossorigin="anonymous"></script>&ndash;&gt;-->
<!--&lt;!&ndash;<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"&ndash;&gt;-->
<!--&lt;!&ndash;        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"&ndash;&gt;-->
<!--&lt;!&ndash;        crossorigin="anonymous"></script>&ndash;&gt;-->
<!--&lt;!&ndash;<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"&ndash;&gt;-->
<!--&lt;!&ndash;        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"&ndash;&gt;-->
<!--&lt;!&ndash;        crossorigin="anonymous"></script>&ndash;&gt;-->
<!--</body>-->
<!--</html>-->


<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
            crossorigin="anonymous"></script>
    <script type="text/javascript">
        async function request(url, method = 'GET', payload) {
            const options = {method, headers: {"Content-type": "application/json", "Accept": "application/json"}}
            if (payload) options.body = JSON.stringify(payload)

            const response = await fetch(url, options)

            if (!response.ok) {
                alert("Ошибка HTTP: " + response.status)
                throw Error("Ошибка HTTP: " + response.status)
            }

            if (method === 'DELETE') return

            return await response.json()
        }

        function showEditUserForm(user, form) {
            document.querySelector(`${form} input[name="id"]`).value = user.id
            document.querySelector(`${form} input[name="username"]`).value = user.username
            document.querySelector(`${form} input[name="city"]`).value = user.city
            document.querySelector(`${form} input[name="email"]`).value = user.email
            document.querySelector(`${form} input[name="password"]`).value = user.password

            Array.from(document.querySelectorAll(`${form} select[name="role"] option`)).forEach(option => {
                if (user.roles.find(role => role.role === option.value)) option.selected = true
            })

            document.getElementById(form.slice(1,)).style.display = 'block'
        }


        // function renderUserList (users) {
        //     const usersList = users.map(user => `
        //         <tr>
        //             <td>${user.id}</td>
        //             <td>${user.username}</td>
        //             <td>${user.password}</td>
        //             <td>${user.email}</td>
        //             <td>${user.city}</td>
        //             <td>${user.roles.map(role => role.role).join(', ')}</td>
        //         </tr>
        //     `).join('')
        //     document.getElementById('users-table').innerHTML = usersList
        // }

        async function  renderUserList (users) {
            const currentUser = await request('http://localhost:8080/api/user')
            console.log(currentUser)
            const cU = `
                <tr>
                    <td>${currentUser.id}</td>
                    <td>${currentUser.username}</td>
                    <td>${currentUser.password}</td>
                    <td>${currentUser.email}</td>
                    <td>${currentUser.city}</td>
                    <td>${currentUser.roles.map(role => role.role).join(', ')}</td>
                </tr>
            `
            document.getElementById('users-table').innerHTML = cU
        }



        function renderCurrentUser(user) {
            document.getElementById('current-user-name').innerText = user.username
            document.getElementById('current-user-role').innerText = user.roles.map(role => role.role).join(', ')
        }

        async function getUsers() {
            const users = await request('http://localhost:8080/api/users')
            await renderUserList(users)
        }

        function getUserDataFromForm(form) {
            console.log(document.querySelectorAll(`${form} select[name="role"] option`))
            const data = {
                username: document.querySelector(`${form} input[name="username"]`).value,
                city: document.querySelector(`${form} input[name="city"]`).value,
                email: document.querySelector(`${form} input[name="email"]`).value,
                password: document.querySelector(`${form} input[name="password"]`).value,
                roles: Array.from(
                    document.querySelectorAll(`${form} select[name="role"] option`)
                ).filter(option => option.selected).map(option => ({role: option.value, id: option.dataset.id}))
            }

            const id = document.querySelector(`${form} input[name="id"]`)
            if (id) data.id = id.value

            return data
        }


        // от сюда удаляется всё


        // async function saveNewUser () {
        //     try {
        //         await request('http://localhost:8080/api/users', 'POST', getUserDataFromForm('#new-user-form'))
        //     } catch (e) {
        //         alert('Не удалось создать пользователя')
        //         throw e
        //     }
        //
        //     getUsers()
        //
        //     alert('Пользователь создан')
        // }
        //
        // async function editUser () {
        //     try {
        //         const data = getUserDataFromForm('#edit-user-form')
        //         await request('http://localhost:8080/api/users', 'PUT', data)
        //     } catch (e) {
        //         alert('Не удалось отредактировать пользователя')
        //         throw e
        //     }
        //
        //     getUsers()
        //
        //     alert('Пользователь отредактирован')
        //
        //     document.getElementById('edit-user-form').style.display = 'none'
        // }
        //
        // async function deleteUser () {
        //     try {
        //         const data = getUserDataFromForm('#delete-user-form')
        //         await request('http://localhost:8080/api/users/' + data.id, 'DELETE')
        //     } catch (e) {
        //         alert('Не удалось удалить пользователя')
        //         throw e
        //     }
        //
        //     getUsers()
        //
        //     alert('Пользователь удален')
        //
        //     document.getElementById('delete-user-form').style.display = 'none'
        // }
        //
        // // до сюда удаляется всё

        window.onload = async function () {
            const currentUser = await request('http://localhost:8080/api/user')
            renderCurrentUser(currentUser)
            await getUsers()
            // document.getElementById('save-new-user').addEventListener('click', saveNewUser)
            // document.getElementById('updateButton').addEventListener('click', editUser)
            // document.getElementById('delete-user-button').addEventListener('click', deleteUser)

            // скрыть форму редактирования пользователя
            // Array.from(document.getElementsByClassName('close-edit-user-from')).forEach(close => {
            //     close.addEventListener('click', () => document.getElementById('edit-user-form').style.display = 'none')
            // })
            //
            // Array.from(document.getElementsByClassName('close-delete-user-from')).forEach(close => {
            //     close.addEventListener('click', () => document.getElementById('delete-user-form').style.display = 'none')
            // })
        }

        // Это тоже удалить

    </script>
</head>






<body>
<nav class="navbar navbar-dark bg-dark justify-content-between">
    <div class="navbar-brand">
        <span id="current-user-name"></span>
        with roles:
        <span id="current-user-role"></span>

    </div>
    <form action="/logout" method="POST">

        <button class="btn btn-dark " type="submit">Logout</button>
    </form>
</nav>


<div class="container-fluid ">
    <br/>
    <div class="row justify-content-md-center">
        <div class="col-lg-2 ">



            <!-- 1 из 2 (узкая) -->
            <div class="list-group col-sm-12 sidenav" >
                <form action="/user" method="GET">
                    <button class="btn btn-primary btn-block"  style="text-align: left" type="submit">User</button>
                </form>
            </div> <!-- 1 из 2 (узкая) Close -->

        </div>

        <div class="col-lg-10 gray tab-content">       <!-- 2 из 2 (широкая) -->



            <h2>User information-page</h2>


            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">

            <div class="gray border">
                <h4 style="text-align: left; margin: 1%"> About user</h4>
            </div>

            <table class="table table-striped table-bordered">

                <thead>
                <tr>
                    <th>User id</th>
                    <th>User name</th>
                    <th>User password</th>
                    <th>User email</th>
                    <th>User city</th>
                    <th>Role</th>
<!--                    <th>ID</th>-->
<!--                    <th>First name</th>-->
<!--                    <th>City</th>-->
<!--                    <th>Email</th>-->
<!--                    <th>Role</th>-->
                </tr>

                </thead>

                <tbody  id="users-table">

                </tbody>
            </table>
                </div>
                                    </div>
        </div>       <!-- 2 из 2 (широкая) Close -->
    </div>
</div>
</div>
</body>
</html>

